[gd_scene load_steps=4 format=2]

[ext_resource path="res://assets/models/tanks/tank_1_1.tscn" type="PackedScene" id=1]

[sub_resource type="GDScript" id=3]
script/source = "extends KinematicBody

# механизм действий
var actions: CActions;

# скорость танка
var speed: float = 5;

# узел готов
func _ready():
	# поднимаем механизм
	actions = CActions.new(self);
	
	# регаем возможные действия
	actions.set_action(CActionsPlayerGo.new(\"up\", \"up\"));
	actions.set_action(CActionsPlayerGo.new(\"down\", \"down\"));
	actions.set_action(CActionsPlayerGo.new(\"left\", \"left\"));
	actions.set_action(CActionsPlayerGo.new(\"right\", \"right\"));
	actions.set_action(CActionsPlayerShot.new(\"shot\"));
	actions.set_action(CActionsPlayerSlip.new(\"slip\"));
	
	# регаем первого игрока в контроллере
	CApp.control_1.set_entity('player', self, [
		[
			CControlRule.new(\"up\", \"ui_player_1_up\", \"ui_player_1_up\"),
			CControlRule.new(\"down\", \"ui_player_1_down\", \"ui_player_1_down\"),
			CControlRule.new(\"left\", \"ui_player_1_left\", \"ui_player_1_left\"),
			CControlRule.new(\"right\", \"ui_player_1_right\", \"ui_player_1_right\")
		],
		[
			CControlRule.new(\"shot\", \"ui_player_1_shot\")
		]
	], true);

# проверка, на льду ли танк
func is_on_ice() -> bool:
	# листаю детекторы
	for _child in get_node(\"IceDetectors\").get_children():
		# если хотя 1 из детекторов наткнулся на лед
		if true == _child.is_colliding():
			# говорим что игрок на льду
			return true;
			
	# в остальных случаях игрок НЕ на льду
	return false;

"

[sub_resource type="BoxShape" id=4]
extents = Vector3( 0.698663, 0.449871, 1 )

[node name="Player_1" type="KinematicBody"]
script = SubResource( 3 )

[node name="tank_1_1" parent="." instance=ExtResource( 1 )]

[node name="CollisionShape" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.449871, 0 )
shape = SubResource( 4 )

[node name="Gun" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.721, -0.803 )

[node name="IceDetectors" type="Spatial" parent="."]

[node name="Detector" type="RayCast" parent="IceDetectors"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.5, 1.5, 0.5 )
enabled = true
collision_mask = 64

[node name="Detector2" type="RayCast" parent="IceDetectors"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.5, 1.5, 0.5 )
enabled = true
collision_mask = 64

[node name="Detector3" type="RayCast" parent="IceDetectors"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.5, 1.5, -0.5 )
enabled = true
collision_mask = 64

[node name="Detector4" type="RayCast" parent="IceDetectors"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.5, 1.5, -0.5 )
enabled = true
collision_mask = 64
